<!doctype html><html><head><title>Adv. PyTorch: Configuring MS Visual Studio for Using PyToch C++ API in Windows</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href=/google-fonts/Mulish/mulish.css><link rel=stylesheet href=/fontawesome/css/all.min.css><link rel=stylesheet href=/css/colortheme/colortheme.css><link rel=icon type=image/png href=/images/site/favicon_hu577c375f84fd7495871e597685ecc2ca_406533_42x0_resize_box_3.png><meta property="og:title" content="Adv. PyTorch: Configuring MS Visual Studio for Using PyToch C++ API in Windows"><meta property="og:description" content="This tutorial will walk you through the required steps to configure and use the PyTorch C++ API (LibTorch) in Microsoft Visual Studio."><meta property="og:type" content="article"><meta property="og:url" content="https://mrnabati.github.io/posts/004_adv_pytorch_integrating_pytorch_cpp_frontend_in_visual_studio_on_windows/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-22T20:17:31-04:00"><meta property="article:modified_time" content="2020-06-22T20:17:31-04:00"><meta name=description content="This tutorial will walk you through the required steps to configure and use the PyTorch C++ API (LibTorch) in Microsoft Visual Studio."><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-129495160-1","auto"),ga("send","pageview"))</script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu577c375f84fd7495871e597685ecc2ca_406533_42x0_resize_box_3.png alt=Logo>
Ramin's Homepage</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><div id=theme-initialization style=display:none default-theme=system></div><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# onclick=enableLightTheme()><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme"></a>
<a class="dropdown-item nav-link" href=# onclick=enableDarkTheme()><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a>
<a class="dropdown-item nav-link" href=# onclick=useSystemTheme()><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/main-logo_hu577c375f84fd7495871e597685ecc2ca_406533_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu577c375f84fd7495871e597685ecc2ca_406533_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/projects/>Projects</a><ul><li><a href=/posts/projects/00_fmow/ title=fMoW>fMoW</a></li><li><a href=/posts/projects/01_spacenet/ title=SpaceNet3>SpaceNet3</a></li><li><a href=/posts/projects/02_ecocar3/ title=EcoCAR3>EcoCAR3</a></li><li><a href=/posts/projects/03_ecocarmc/ title="EcoCAR Mobility Challenge">EcoCAR Mobility Challenge</a></li><li><a href=/posts/projects/04_rrpn/ title=RRPN>RRPN</a></li><li><a href=/posts/projects/05_radar_camera_fusion/ title=RCSF>RCSF</a></li><li><a href=/posts/projects/06_centerfusion/ title=CenterFusion>CenterFusion</a></li></ul></li><li><a href=https://medium.com/@ramin.nabati/installing-an-nvme-ssd-drive-on-nvidia-jetson-xavier-37183c948978 title="NVMe SSD on Nvidia Jetson Xavier">NVMe SSD on Nvidia Jetson Xavier</a></li><li><a href=https://medium.com/@ramin.nabati/enabling-can-on-nvidia-jetson-xavier-developer-kit-aaaa3c4d99c9 title="Enable CAN on Nvidia Jetson Xavier">Enable CAN on Nvidia Jetson Xavier</a></li><li><a href=/posts/002_adv_pytorch_freezing_layers/ title="Pytorch: Freezing Layers">Pytorch: Freezing Layers</a></li><li><a href=/posts/003_adv_pytorch_modifying_the_last_layer/ title="Pytorch: Modifying Layers">Pytorch: Modifying Layers</a></li><li><a class=active href=/posts/004_adv_pytorch_integrating_pytorch_cpp_frontend_in_visual_studio_on_windows/ title="Pytorch: C++ API">Pytorch: C++ API</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/posts/004_adv_pytorch_integrating_pytorch_cpp_frontend_in_visual_studio_on_windows/images/featured.png)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/ramin_hu577c375f84fd7495871e597685ecc2ca_406533_120x120_fit_box_3.png alt="Author Image"><h5 class=author-name>Ramin Nabati</h5><p>Monday, June 22, 2020</p></div><div class=title><h1>Adv. PyTorch: Configuring MS Visual Studio for Using PyToch C++ API in Windows</h1></div><div class=taxonomy-terms><ul style=padding-left:0></ul></div><div class=post-content id=post-content><p>This tutorial will walk you through the required steps to configure
and use the PyTorch C++ API (LibTorch) in Microsoft Visual Studio. Although
the recommended build system for LibTorch is CMake, you might find yourself in
situations where you need to integrate your code into an existing Visual Studio
Project/Solution and don&rsquo;t want to deal with CMake files in Windows. Following
the steps in this tutorial should get you up and running with LibTorch in
Visual Studio without needing to use CMake to build it. These steps
have been tested on Visual Studio 2019 and the CPU version of LibTorch 1.5.1.
Let&rsquo;s get started!</p><h2 id=step-1-download-libtorch>Step 1: Download LibTorch</h2><ul><li><p>Download and extract the CPU version of LibTorch for Windows from <a href=https://pytorch.org/get-started/locally/>here</a>.
Note that the <strong>Release</strong> and <strong>Debug</strong> versions have different download links,
so get the one you need depending on your target configuration. We work with the
Debug version here.</p><p><img src=assets/013_1.png alt=img1></p></li></ul><h2 id=step-2-set-windows-environment-variables>Step 2: Set Windows Environment Variables</h2><ul><li><p>We&rsquo;re going to create some environment variables to make things easier. Use the
following commands in a Windows Terminal to create an environment variable for
the LibTorch directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>setx LIBTORCH_DEBUG_HOME <span style=color:#e6db74>&#34;C:\libtorch-debug-v1.5.1&#34;</span>
</span></span><span style=display:flex><span>set LIBTORCH_DEBUG_HOME <span style=color:#e6db74>&#34;C:\libtorch-debug-v1.5.1&#34;</span>
</span></span></code></pre></div><p>where <code>"C:\libtorch-debug-v1.5.1"</code> is the path to the extracted LibTorch
directory on your computer. Note that the <code>setx</code> command creates the variable
globally for Windows, and the <code>set</code> command creates it just for the current
session.</p></li><li><p>If you want to build PyTorch C++ extensions, you&rsquo;ll need to add the Python
header files to your Visual Studio project. Use the following commands to
create environment variables for your Python path. Note that if Python
was installed as part of the Visual Studio, the Python directory
should be in <code>"C:\Program Files (x86)\Microsoft Visual Studio\Shared"</code>. Otherwise
locate your Python installation directory and change the path accordingly.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>setx PYTHON_HOME <span style=color:#e6db74>&#34;C:\Program Files (x86)\Microsoft Visual Studio\Shared\Python37_64&#34;</span>
</span></span><span style=display:flex><span>set PYTHON_HOME <span style=color:#e6db74>&#34;C:\Program Files (x86)\Microsoft Visual Studio\Shared\Python37_64&#34;</span>
</span></span></code></pre></div></li></ul><h2 id=step-3-configure-your-visual-studio-project>Step 3: Configure Your Visual Studio Project</h2><ul><li><p>Open Visual Studio, create a project and make sure the Platform is set to
<strong>x64</strong>. Following <a href=https://pytorch.org/tutorials/advanced/cpp_frontend.html>this tutorial</a>,
let&rsquo;s create a simple C++ file called <code>dcgan.cpp</code> with the following contents
to test our setup later.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;torch\torch.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;iostream&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(){
</span></span><span style=display:flex><span>    torch<span style=color:#f92672>::</span>Tensor tensor <span style=color:#f92672>=</span> torch<span style=color:#f92672>::</span>eye(<span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> tensor <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p>In <strong>Project Properties</strong> under <code>C/C++ -> General -> Additional Include Directories</code> add
the path to LibTorch and Python include folders:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>$(</span>LIBTORCH_DEBUG_HOME<span style=color:#66d9ef>)</span><span style=color:#ae81ff>\i</span>nclude
</span></span><span style=display:flex><span><span style=color:#66d9ef>$(</span>PYTHON_HOME<span style=color:#66d9ef>)</span><span style=color:#ae81ff>\i</span>nclude
</span></span></code></pre></div><p><img src=assets/013_2.PNG alt=img2></p></li><li><p>In <strong>Project Properties</strong> under <code>Linker -> General -> Additional Library Directories</code> add
the path to LibTorch and Python lib folders:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> <span style=color:#66d9ef>$(</span>LIBTORCH_DEBUG_HOME<span style=color:#66d9ef>)</span><span style=color:#ae81ff>\l</span>ib
</span></span><span style=display:flex><span> <span style=color:#66d9ef>$(</span>PYTHON_HOME<span style=color:#66d9ef>)</span><span style=color:#ae81ff>\l</span>ib
</span></span></code></pre></div><p><img src=assets/013_3.PNG alt=img2></p></li><li><p>In <strong>Project Properties</strong> under <code>Linker -> Input -> Additional Dependencies</code>
add the following libraries:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> torch.lib
</span></span><span style=display:flex><span> torch_cpu.lib
</span></span><span style=display:flex><span> c10.lib
</span></span><span style=display:flex><span> python37.lib
</span></span></code></pre></div><p><img src=assets/013_4.PNG alt=img2></p></li><li><p>We also need to add a <strong>Post-Build Event</strong> to copy all the LibTorch <code>dll</code>
files to the target directory after every build. Without these files you&rsquo;ll be
getting a runtime error when executing your program. In <strong>Project Properties</strong> under
<code>Build Events -> Post-Build Event -> Command Line</code> add the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>copy /y <span style=color:#66d9ef>$(</span>LIBTORCH_DEBUG_HOME<span style=color:#66d9ef>)</span><span style=color:#ae81ff>\l</span>ib<span style=color:#ae81ff>\*</span>.dll <span style=color:#66d9ef>$(</span>TargetDir<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p><img src=assets/013_5.PNG alt=img2></p></li></ul><h2 id=step-4-build-and-run-the-code>Step 4: Build and Run the Code</h2><ul><li><p>Now you can go ahead and build the project. Make sure you choose the same
build configuration (Debug/Release) as the downloaded LibTorch package. To
test our setup, run the generated executable file. The output should be a
3x3 diagonal matrix:</p><pre tabindex=0><code> 1  0  0
 0  1  0
 0  0  1
[ CPUFloatType{3,3} ]
</code></pre></li></ul><hr></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn btn-sm facebook-btn" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmrnabati.github.io%2fposts%2f004_adv_pytorch_integrating_pytorch_cpp_frontend_in_visual_studio_on_windows%2f" target=_blank><i class="fab fa-facebook"></i></a>
<a class="btn btn-sm twitter-btn" href="https://twitter.com/share?url=https%3a%2f%2fmrnabati.github.io%2fposts%2f004_adv_pytorch_integrating_pytorch_cpp_frontend_in_visual_studio_on_windows%2f&text=Adv.%20PyTorch%3a%20Configuring%20MS%20Visual%20Studio%20for%20Using%20PyToch%20C%2b%2b%20API%20in%20Windows&via=Ramin%27s%20Homepage" target=_blank><i class="fab fa-twitter"></i></a>
<a class="btn btn-sm reddit-btn" href="https://reddit.com/submit?url=https%3a%2f%2fmrnabati.github.io%2fposts%2f004_adv_pytorch_integrating_pytorch_cpp_frontend_in_visual_studio_on_windows%2f&title=Adv.%20PyTorch%3a%20Configuring%20MS%20Visual%20Studio%20for%20Using%20PyToch%20C%2b%2b%20API%20in%20Windows" target=_blank><i class="fab fa-reddit"></i></a>
<a class="btn btn-sm linkedin-btn" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fmrnabati.github.io%2fposts%2f004_adv_pytorch_integrating_pytorch_cpp_frontend_in_visual_studio_on_windows%2f&title=Adv.%20PyTorch%3a%20Configuring%20MS%20Visual%20Studio%20for%20Using%20PyToch%20C%2b%2b%20API%20in%20Windows" target=_blank><i class="fab fa-linkedin"></i></a>
<a class="btn btn-sm whatsapp-btn" href="https://api.whatsapp.com/send?text=Adv.%20PyTorch%3a%20Configuring%20MS%20Visual%20Studio%20for%20Using%20PyToch%20C%2b%2b%20API%20in%20Windows https%3a%2f%2fmrnabati.github.io%2fposts%2f004_adv_pytorch_integrating_pytorch_cpp_frontend_in_visual_studio_on_windows%2f" target=_blank><i class="fab fa-whatsapp"></i></a>
<a class="btn btn-sm email-btn" href="mailto:?subject=Adv.%20PyTorch%3a%20Configuring%20MS%20Visual%20Studio%20for%20Using%20PyToch%20C%2b%2b%20API%20in%20Windows&body=https%3a%2f%2fmrnabati.github.io%2fposts%2f004_adv_pytorch_integrating_pytorch_cpp_frontend_in_visual_studio_on_windows%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https:/github.com/mrnabati/mrnabati.github.io/edit/main/content/posts/004_adv_pytorch_integrating_pytorch_cpp_frontend_in_visual_studio_on_windows/index.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/003_adv_pytorch_modifying_the_last_layer/ title="Adv. PyTorch: Modifying the Last Layer" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>Adv. PyTorch: Modifying the Last Layer</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#step-1-download-libtorch>Step 1: Download LibTorch</a></li><li><a href=#step-2-set-windows-environment-variables>Step 2: Set Windows Environment Variables</a></li><li><a href=#step-3-configure-your-visual-studio-project>Step 3: Configure Your Visual Studio Project</a></li><li><a href=#step-4-build-and-run-the-code>Step 4: Build and Run the Code</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://mrnabati.github.io/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://mrnabati.github.io/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://mrnabati.github.io/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://mrnabati.github.io/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://mrnabati.github.io/#publications>Publications</a></li><li class=nav-item><a class=smooth-scroll href=https://mrnabati.github.io/#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=https://github.com/mrnabati target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>mrnabati</span></a></li><li><a href=https://www.linkedin.com/in/ramin-nabati target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Ramin Nabati</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2022 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script type=text/javascript src=/js/darkreader.js></script>
<script type=text/javascript src=/js/darkmode-darkreader.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script><link rel=stylesheet href=/katex/katex.min.css><script type=text/javascript defer src=/katex/katex.min.js></script>
<script type=text/javascript defer src=/katex/auto-render.min.js onload=renderMathInElement(document.body)>renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})</script><script src=/js/mermaid-8.14.0.min.js></script>
<script>mermaid.initialize({startOnLoad:!0})</script></body></html>